{"version":3,"file":"commonHelpers2.js","sources":["../src/js/infinitescroll.js"],"sourcesContent":["import apiService from './api';\r\nimport { lightbox } from './lightbox';\r\nimport iziToast from 'izitoast';\r\nimport 'izitoast/dist/css/iziToast.min.css';\r\n\r\nconst searchButton = document.getElementById(\"search-button\");\r\nconst galleryContainer = document.querySelector('.gallery');\r\nconst searchQueryInput = document.querySelector('#search-bar');\r\n\r\nlet isShown = 0;\r\nlet isFirstSearch = true;\r\nlet query = '';\r\nlet page = 1; // Номер сторінки для запиту\r\nconst gallery = document.querySelector(\".gallery\");\r\n\r\nconst observerOptions = {\r\n  root: null,\r\n  rootMargin: '0px',\r\n  threshold: 0.5,\r\n};\r\n\r\nconst intersectionObserver = new IntersectionObserver(handleIntersection, observerOptions);\r\n\r\nsearchButton.addEventListener(\"click\", function(event) {  \r\n  event.preventDefault();\r\n  onSearch();\r\n  isFirstSearch = true;    \r\n});\r\n\r\nsearchQueryInput.addEventListener(\"keydown\", function(event) {\r\n  if (event.key === 'Enter') {\r\n    event.preventDefault();\r\n    onSearch();\r\n  }\r\n  isFirstSearch = true;\r\n});\r\n\r\nasync function onSearch() {\r\n  const searchQuery = searchQueryInput.value.trim();\r\n  \r\n  apiService.setQuery(searchQuery);   \r\n\r\n  if (searchQuery === '') {    \r\n    showWarningToast('Будь ласка, заповніть поле пошуку');\r\n    return;\r\n  }\r\n\r\n    if (searchQuery === query) {    \r\n    showWarningToast('Будь ласка, змініть або введіть новий запит до поля пошуку.');\r\n    return;\r\n  }\r\n  \r\n  galleryContainer.innerHTML = '';\r\n  apiService.resetPage();\r\n  query = searchQuery;\r\n  isShown = 0; \r\n  page = 1; // Скидаємо номер сторінки\r\n  await fetchGallery();\r\n}\r\n\r\nasync function fetchGallery() {\r\n  try {\r\n    const result = await apiService.fetchGallery();\r\n    const { hits, totalHits } = result;\r\n\r\n    if (!hits.length) {\r\n      showErrorToast(\"Вибачте, немає зображень, які відповідають вашому запиту. Будь ласка, спробуйте ще раз.\");\r\n      return;\r\n    }\r\n\r\n    if (isFirstSearch && isShown < totalHits) {\r\n      showSuccessToast(`Ура! Ми знайшли ${totalHits} зображень !!!`);\r\n      isFirstSearch = false;\r\n    }\r\n\r\n    onRenderGallery(hits);\r\n    isShown += hits.length;\r\n\r\n    const lastElement = galleryContainer.lastElementChild;\r\n    if (lastElement) {\r\n      intersectionObserver.observe(lastElement);\r\n    }   \r\n\r\n    if (isShown >= totalHits) {      \r\n      intersectionObserver.disconnect();\r\n      showInfoToast(\"Ви досягли кінця результатів пошуку.\");\r\n    }\r\n  } catch (error) {\r\n    console.error(\"Помилка отримання галереї:\", error);\r\n    showErrorToast(\"Під час отримання галереї сталася помилка.\");\r\n  }\r\n}\r\n\r\nasync function fetchImages(query) {\r\n    const response = await axios.get(`https://api.example.com/images`, {\r\n        params: {\r\n            q: query,\r\n            page: page,\r\n            per_page: 20,\r\n        },\r\n    });\r\n    return response.data;\r\n}\r\n\r\nasync function loadMoreImages() {\r\n    const query = document.querySelector(\"#search-bar\").value;\r\n    const data = await fetchImages(query);\r\n\r\n    // Додайте нові зображення до галереї\r\n    const markup = data.hits\r\n        .map(\r\n            (hit) =>\r\n                `<div class=\"gallery-item\"><img src=\"${hit.webformatURL}\" alt=\"${hit.tags}\"></div>`\r\n        )\r\n        .join(\"\");\r\n    gallery.insertAdjacentHTML(\"beforeend\", markup);\r\n\r\n    if (page * 20 >= data.totalHits) {\r\n        document.querySelector(\"#load-more\").hidden = true;\r\n        alert(\"Вибачте, але ви досягли кінця результатів пошуку.\");\r\n    }\r\n\r\n    smoothScroll(); // Плавне прокручування\r\n    page++; // Збільшуємо номер сторінки\r\n}\r\n\r\n// Відстеження прокручування\r\nwindow.addEventListener(\"scroll\", () => {\r\n    if (\r\n        window.innerHeight + window.scrollY >=\r\n        document.documentElement.scrollHeight\r\n    ) {\r\n        loadMoreImages();\r\n    }\r\n});\r\n\r\ndocument.querySelector(\"#load-more\").addEventListener(\"click\", loadMoreImages);\r\n\r\nfunction onRenderGallery(elements) {\r\n  const markup = elements.map(({ webformatURL, largeImageURL, tags, likes, views, downloads }) => {\r\n    return `\r\n      <div class=\"photo-card\">\r\n        <a href=\"${largeImageURL}\">\r\n          <img class=\"photo-img\" src=\"${webformatURL}\" alt=\"${tags}\" loading=\"lazy\" />\r\n        </a>\r\n        <div class=\"info\">\r\n          <p class=\"info-item\"><b>Likes</b><span class=\"info__span\">${likes}</span></p>\r\n          <p class=\"info-item\"><b>Views</b><span class=\"info__span\">${views}</span></p>\r\n          <p class=\"info-item\"><b>Downloads</b><span class=\"info__span\">${downloads}</span></p>\r\n        </div>\r\n      </div>`;\r\n  }).join('');\r\n\r\n  galleryContainer.insertAdjacentHTML('beforeend', markup);\r\n  lightbox.refresh();\r\n  smoothScroll();\r\n}\r\n\r\nfunction handleIntersection(entries, _observer) {\r\n  entries.forEach((entry) => {\r\n    if (entry.isIntersecting) {\r\n      apiService.incrementPage()\r\n      fetchGallery();\r\n    }\r\n  });\r\n}\r\n\r\nfunction smoothScroll() {\r\n    const { height: cardHeight } = document\r\n        .querySelector(\".gallery\")\r\n        .firstElementChild.getBoundingClientRect();\r\n\r\n    window.scrollBy({\r\n        top: cardHeight * 2,\r\n        behavior: \"smooth\",\r\n    });\r\n}\r\n\r\nfunction showWarningToast(message) {\r\n  iziToast.warning({\r\n    title: 'Warning',\r\n    message: message,\r\n    position: 'topRight',\r\n    color: 'yellow',\r\n    timeout: 4000,\r\n    closeOnEscape: true,\r\n    closeOnClick: true,\r\n  });\r\n}\r\n\r\nfunction showErrorToast(message) {\r\n  iziToast.error({\r\n    title: 'Error',\r\n    message: message,\r\n    position: 'topRight',\r\n    color: 'red',\r\n    timeout: 3000,\r\n    closeOnEscape: true,\r\n    closeOnClick: true,\r\n  });\r\n}\r\n\r\nfunction showSuccessToast(message) {\r\n  iziToast.success({\r\n    title: 'Success',\r\n    message: message,\r\n    position: 'topRight',\r\n    color: 'green',\r\n    timeout: 2000,\r\n    closeOnEscape: true,\r\n    closeOnClick: true,\r\n  });\r\n}\r\n\r\nfunction showInfoToast(message) {\r\n  iziToast.info({\r\n    title: 'Info',\r\n    message: message,\r\n    position: 'topRight',\r\n    color: 'blue',\r\n    timeout: 3000,\r\n    closeOnEscape: true,\r\n    closeOnClick: true,\r\n  });\r\n}"],"names":["searchButton","galleryContainer","searchQueryInput","isShown","isFirstSearch","query","page","gallery","observerOptions","intersectionObserver","handleIntersection","event","onSearch","searchQuery","apiService","showWarningToast","fetchGallery","result","hits","totalHits","showErrorToast","showSuccessToast","onRenderGallery","lastElement","showInfoToast","error","fetchImages","loadMoreImages","data","markup","hit","smoothScroll","elements","webformatURL","largeImageURL","tags","likes","views","downloads","lightbox","entries","_observer","entry","cardHeight","message","iziToast"],"mappings":"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"}